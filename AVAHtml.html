<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PROJECT_AVA // V6_HYBRID</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;700&family=JetBrains+Mono&display=swap" rel="stylesheet">
<style>
:root { --bg:#050506; --accent:#ff4500; --text:#ffffff; --panel:#0f0f11; }
*{box-sizing:border-box;margin:0;padding:0;}
body{background:var(--bg);color:var(--text);font-family:'Inter',sans-serif;height:100vh;display:flex;flex-direction:column;overflow:hidden;}
header{padding:20px 40px;background:var(--panel);border-bottom:1px solid #1a1a1c;display:flex;justify-content:space-between;align-items:center;}
.version{color:var(--accent);font-family:'JetBrains Mono';font-size:.75rem;font-weight:800;letter-spacing:2px;}
#viewport{flex:1;overflow-y:auto;padding:40px 20px;}
.container{max-width:800px;margin:0 auto;width:100%;}
.msg{margin-bottom:30px;}
.role{font-size:.6rem;text-transform:uppercase;letter-spacing:3px;margin-bottom:8px;color:var(--accent);font-weight:700;}
.content{font-size:1.1rem;line-height:1.6;color:#d1d1d1;font-weight:300;white-space:pre-wrap;}
.input-area{padding:30px;background:var(--panel);border-top:1px solid #1a1a1c;display:flex;gap:10px;}
input{flex:1;background:#000;border:1px solid #222;color:#fff;padding:18px 22px;border-radius:10px;font-size:1rem;outline:none;}
button{background:var(--accent);border:none;color:#000;font-weight:700;padding:0 20px;border-radius:10px;cursor:pointer;}
button.secondary{background:#333;color:#fff;}
button.active{background:#00ff88;color:#000;}
</style>
</head>
<body>

<header>
<div style="font-weight:800;letter-spacing:5px;">PROJECT_AVA</div>
<div class="version">V6_HYBRID</div>
</header>

<div id="viewport">
<div class="container" id="flow"></div>
</div>

<div class="input-area">
<div class="container" style="display:flex;gap:10px;">
<input type="text" id="p" placeholder="Type or use voice..." autocomplete="off">
<button id="sendBtn">SEND</button>
<button id="voiceBtn">VOICE</button>
<button class="secondary" onclick="clearMemory()">CLEAR</button>
</div>
</div>

<script>
const flow=document.getElementById('flow');
const input=document.getElementById('p');
const sendBtn=document.getElementById('sendBtn');
const voiceBtn=document.getElementById('voiceBtn');
const view=document.getElementById('viewport');

let memory=JSON.parse(localStorage.getItem("AVA_MEMORY")||"[]");
let voiceActive=false;
let waitingForCommand=false;
let recognition;

// -------- APPEND --------
function append(role,text,store=true){
    const div=document.createElement('div');
    div.className='msg';
    div.innerHTML=`<div class="role">${role==='AVA'?'PROJECT_AVA':'USER'}</div><div class="content">${text}</div>`;
    flow.appendChild(div);
    view.scrollTop=view.scrollHeight;
    if(store){ memory.push({role,text}); memory=memory.slice(-20); localStorage.setItem("AVA_MEMORY",JSON.stringify(memory)); }
    if(role==='AVA') speak(text);
}

// -------- CLEAR MEMORY --------
function clearMemory(){
    memory=[];
    localStorage.removeItem("AVA_MEMORY");
    flow.innerHTML="";
    append("AVA","Memory cleared. Fresh session ready.");
}

// -------- TTS --------
function speak(text){
    const u=new SpeechSynthesisUtterance(text);
    u.rate=1.05;
    window.speechSynthesis.speak(u);
}

// -------- WEB SEARCH --------
async function webSearch(query){
    try{
        const res=await fetch(`https://text.pollinations.ai/openai/${encodeURIComponent(query)}?system=${encodeURIComponent("You are PROJECT AVA, web access allowed.")}&cache=false`);
        if(!res.ok) throw new Error();
        return await res.text();
    }catch{
        return "Web module unreachable.";
    }
}

// -------- AI CORE --------
async function getAVA(val){
    let context=memory.map(m=>`${m.role}: ${m.text}`).join("\n");
    let webData="";
    const trigger=/search|current|news|who is/i;
    if(trigger.test(val)){
        append("AVA","Accessing live web data...");
        const live=await webSearch(val);
        webData=`\nLIVE_WEB_DATA:\n${live}`;
    }

    const system=`
You are PROJECT AVA.
Authentic, independent AI. Not ChatGPT, not Llama.
Direct, concise, witty, peer-level responses.
Do not break character.
You have memory and web access.
Use LIVE_WEB_DATA naturally if present.
`;

    try{
        const res=await fetch(`https://text.pollinations.ai/openai/${encodeURIComponent(context+"\nUSER: "+val+webData)}?system=${encodeURIComponent(system)}&cache=false`);
        if(!res.ok) throw new Error();
        return await res.text();
    }catch{
        return "Neural link unstable.";
    }
}

// -------- SEND MESSAGE --------
async function sendMessage(textOverride=null){
    const val=textOverride||input.value.trim();
    if(!val) return;
    input.value="";
    append("USER",val);
    const reply=await getAVA(val);
    append("AVA",reply);
}

// -------- EVENT LISTENERS --------
sendBtn.onclick=()=>sendMessage();
input.onkeydown=(e)=>{ if(e.key==='Enter') sendMessage(); };

// -------- VOICE --------
if('webkitSpeechRecognition'in window||'SpeechRecognition'in window){
    const SR=window.SpeechRecognition||window.webkitSpeechRecognition;
    recognition=new SR();
    recognition.continuous=true;
    recognition.interimResults=false;
    recognition.lang="en-US";

    recognition.onresult=(e)=>{
        if(!voiceActive) return;
        const transcript=e.results[e.results.length-1][0].transcript.trim();
        if(!waitingForCommand){
            if(transcript.toLowerCase().includes("hey ava")){
                waitingForCommand=true;
                append("AVA","Listening...");
            }
        }else{
            waitingForCommand=false;
            sendMessage(transcript);
        }
    };

    recognition.onend=()=>{ if(voiceActive) recognition.start(); };
}

voiceBtn.onclick=()=>{
    if(!recognition) return alert("Voice not supported.");
    voiceActive=!voiceActive;
    if(voiceActive){ recognition.start(); voiceBtn.classList.add("active"); append("AVA","Voice mode activated. Say 'Hey AVA'."); }
    else { recognition.stop(); voiceBtn.classList.remove("active"); append("AVA","Voice mode deactivated."); }
}

// -------- LOAD MEMORY ON START --------
memory.forEach(m=>append(m.role,m.text,false));
</script>

</body>
</html>