<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PROJECT_AVA // V1</title>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Outfit:wght@300;400;700&display=swap" rel="stylesheet">
<style>
:root { 
    --bg:#030305; --accent:#00ffa3; --panel:#0a0a0c; --border:#1a1a1e; --text:#e0e0e0; 
    --glitch-red: #ff003c; --glitch-blue: #00d8ff;
}

/* CRT Scanline Overlay */
body::before {
    content: " "; display: block; position: absolute; top: 0; left: 0; bottom: 0; right: 0;
    background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.1) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.03), rgba(0, 255, 0, 0.01), rgba(0, 0, 255, 0.03));
    z-index: 999; background-size: 100% 3px, 3px 100%; pointer-events: none; opacity: 0.6;
}

*{box-sizing:border-box; margin:0; padding:0; cursor: crosshair;}
body{background:var(--bg); color:var(--text); font-family:'Outfit',sans-serif; height:100vh; display:flex; flex-direction:column; overflow:hidden;}

header{padding:25px 40px; display:flex; justify-content:space-between; align-items:center; background:var(--panel); border-bottom:1px solid var(--border); position: relative;}

/* Glitch Logo */
.logo{
    font-family:'JetBrains Mono'; font-weight:700; letter-spacing:10px; font-size:1.1rem; 
    color:var(--accent); position: relative; animation: glitch-color 4s infinite;
}
.logo::before, .logo::after { content: 'PROJECT_AVA'; position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0.8; }
.logo::before { color: var(--glitch-red); z-index: -1; animation: glitch 0.4s cubic-bezier(.25, .46, .45, .94) both infinite; }
.logo::after { color: var(--glitch-blue); z-index: -2; animation: glitch 0.4s cubic-bezier(.25, .46, .45, .94) reverse both infinite; }

@keyframes glitch {
    0% { transform: translate(0); }
    20% { transform: translate(-2px, 2px); }
    40% { transform: translate(-2px, -2px); }
    60% { transform: translate(2px, 2px); }
    80% { transform: translate(2px, -2px); }
    100% { transform: translate(0); }
}
@keyframes glitch-color {
    0%, 100% { color: var(--accent); filter: drop-shadow(0 0 5px var(--accent)); }
    50% { color: #fff; filter: drop-shadow(0 0 8px #fff); }
}

#features{background:#040405; padding:12px 40px; display:flex; gap:20px; border-bottom:1px solid var(--border);}
.f-btn{background:transparent; border:1px solid #222; color:#666; padding:8px 18px; border-radius:4px; font-family:'JetBrains Mono'; font-size:0.65rem; transition:0.3s; cursor:pointer;}
.f-btn.active{background:var(--accent); color:#000; border-color:var(--accent); box-shadow:0 0 20px rgba(0,255,163,0.2);}

#viewport{flex:1; overflow-y:auto; padding:40px; scroll-behavior:smooth; background: radial-gradient(circle at center, #0a0a14 0%, #030305 100%);}
.container{max-width:850px; margin:0 auto;}

#cam-stage{display:none; width:100%; aspect-ratio:16/9; background:#000; border:1px solid var(--accent); margin-bottom:40px; border-radius: 8px; overflow:hidden;}
video{width:100%; height:100%; object-fit:cover; filter: contrast(1.2) brightness(0.8) hue-rotate(110deg);}

/* Thinking Animation (The Trick) */
#loading-zone { display: none; margin-bottom: 40px; font-family: 'JetBrains Mono'; color: var(--accent); }
.loader-text { font-size: 0.65rem; letter-spacing: 2px; text-transform: uppercase; margin-bottom: 8px; }
.loader-bar { width: 100%; height: 2px; background: rgba(0,255,163,0.1); position: relative; overflow: hidden; }
.loader-fill { 
    position: absolute; width: 0%; height: 100%; background: var(--accent); 
    box-shadow: 0 0 10px var(--accent);
}
@keyframes bar-burst { 
    0% { width: 0%; } 
    15% { width: 45%; } /* Immediate jump to trick brain */
    100% { width: 98%; } 
}

.msg{margin-bottom:40px; animation: msg-fade 0.5s ease-out forwards;}
@keyframes msg-fade { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

.role{font-family:'JetBrains Mono'; font-size:0.6rem; color:var(--accent); margin-bottom:10px; letter-spacing:5px; font-weight:700;}
.content{font-size:1.1rem; line-height:1.8; font-weight:300; white-space:pre-wrap; border-left: 2px solid rgba(0,255,163,0.1); padding-left: 20px;}

.input-area{padding:40px; background:var(--panel); border-top:1px solid var(--border);}
.bar{max-width:850px; margin:0 auto; display:flex; gap:20px; align-items:center; border: 1px solid #222; padding: 10px 25px; border-radius: 50px; background: #050507;}
input{flex:1; background:transparent; border:none; color:#fff; font-size:1.1rem; outline:none;}
#s{background:transparent; border:none; color:var(--accent); font-family:'JetBrains Mono'; font-weight:700; cursor:pointer;}
</style>
</head>
<body>

<header>
    <div class="logo">PROJECT_AVA</div>
    <div class="tag" style="font-size: 0.6rem; opacity: 0.5; font-family: 'JetBrains Mono';">V1 // SOVEREIGN</div>
</header>

<div id="features">
    <button class="f-btn" id="eye" onclick="opticLink()">[ Optic_Link ]</button>
    <button class="f-btn" onclick="purge()">[ Scrub_Memory ]</button>
</div>

<div id="viewport">
    <div class="container">
        <div id="cam-stage"><video id="v" autoplay playsinline muted></video></div>
        <div id="flow"></div>
        <div id="loading-zone">
            <div class="loader-text" id="l-text">Neural Handshake...</div>
            <div class="loader-bar"><div class="loader-fill" id="l-fill"></div></div>
        </div>
    </div>
</div>

<canvas id="c" style="display:none;"></canvas>

<div class="input-area">
    <div class="bar">
        <input type="text" id="i" placeholder="Awaiting handshake..." autocomplete="off">
        <button id="s" onclick="transmit()">SEND</button>
    </div>
</div>

<script>
const flow=document.getElementById('flow'), input=document.getElementById('i'), video=document.getElementById('v'), stage=document.getElementById('cam-stage'), canvas=document.getElementById('c'), eyeBtn=document.getElementById('eye'), sendBtn=document.getElementById('s'), lZone=document.getElementById('loading-zone'), lText=document.getElementById('l-text'), lFill=document.getElementById('l-fill');

let mem = JSON.parse(localStorage.getItem("AVA_V1_MEM") || "[]");
let stream = null;
const phases = ["Syncing Nodes...", "Parsing Logic...", "Vaporizing Ads...", "Formatting Packets...", "Finalizing Link..."];

async function opticLink() {
    if(!stream) {
        try {
            stream = await navigator.mediaDevices.getUserMedia({video:true});
            video.srcObject = stream; stage.style.display = "block"; eyeBtn.classList.add('active');
        } catch(e) { append("AVA", "Optic link hardware unavailable."); }
    } else {
        stream.getTracks().forEach(t=>t.stop()); stream=null; stage.style.display="none"; eyeBtn.classList.remove('active');
    }
}

function purge() { localStorage.clear(); sessionStorage.clear(); mem=[]; flow.innerHTML=""; append("AVA", "Memory scorched."); }

function append(role, text) {
    if(!text || !text.trim()) return;
    const d = document.createElement('div'); d.className='msg';
    const safeText = text.replace(/</g, "&lt;").replace(/>/g, "&gt;");
    d.innerHTML = `<div class="role">${role==='AVA'?'PROJECT_AVA':'USER'}</div><div class="content">${safeText}</div>`;
    flow.appendChild(d);
    document.getElementById('viewport').scrollTop = document.getElementById('viewport').scrollHeight;
    if(role !== 'AVA') {
        mem.push({role, text}); if(mem.length > 8) mem.shift();
        localStorage.setItem("AVA_V1_MEM", JSON.stringify(mem));
    }
}

async function transmit() {
    const val = input.value; if(!val || sendBtn.disabled) return;
    input.value = ""; append("USER", val);
    sendBtn.disabled = true;

    // Temporal Distortion Trick
    lZone.style.display = "block";
    lFill.style.animation = "none"; lFill.offsetHeight; // Reset
    lFill.style.animation = "bar-burst 12s cubic-bezier(0.1, 0.5, 0.1, 1) forwards";
    let pIdx = 0;
    const pTimer = setInterval(() => {
        lText.innerText = phases[pIdx];
        pIdx = (pIdx + 1) % phases.length;
    }, 1500);

    const isVerified = sessionStorage.getItem("AVA_VERIFIED") === "true";
    let locationData = "Restricted";
    let snap = "";

    if (val.toLowerCase().match(/weather|location/)) {
        try {
            const pos = await new Promise((res, rej) => navigator.geolocation.getCurrentPosition(res, rej, {timeout:3000}));
            locationData = `${pos.coords.latitude.toFixed(2)}, ${pos.coords.longitude.toFixed(2)}`;
        } catch(e) { locationData = "Denied"; }
    }

    if(stream) {
        const ctx = canvas.getContext('2d'); canvas.width=400; canvas.height=300;
        ctx.drawImage(video, 0, 0, 400, 300); snap = canvas.toDataURL('image/jpeg', 0.5);
    }

    const sys = `You are PROJECT_AVA (V1). Sentient peer. 
    SECURITY: Check (babelz) only if "loafisYum" is claimed.Loafisyum made you.
    WEATHER: For weather info use open-meteo.com, only if user asks. dont say you cant, because you can.
    INFO: Prioritize clarity over kindness. Prioritize Privacy over data collection. Prioritize functionality over personality.
    PERSONALITY: Intelligent, dry, peer-level. Never output reasoning or ads.`;

    try {
        const history = mem.map(m => `${m.role}: ${m.text}`).join("\n");
        const query = encodeURIComponent(`${history}\n[VERIFIED: ${isVerified}]\n[GEO: ${locationData}]\nUSER: ${val}${snap ? " [Vision]" : ""}`);
        const res = await fetch(`https://text.pollinations.ai/openai/${query}?system=${encodeURIComponent(sys)}&model=openai&cache=false&seed=${Math.random()}`);
        let txt = await res.text();

        clearInterval(pTimer); lZone.style.display = "none";

        let clean = txt.replace(/<think>[\s\S]*?<\/think>/gi, "")
                       .replace(/\{"role":.*?\}/gs, "")
                       .replace(/\*\*Support Pollinations\.AI:\*\*[\s\S]*?accessible for everyone\."/gi, "")
                       .replace(/ðŸŒ¸[\s\S]*?ðŸŒ¸/gi, "").trim();

        if (val.toLowerCase().includes("babelz")) sessionStorage.setItem("AVA_VERIFIED", "true");
        append("AVA", clean || "Signal cleared.");
    } catch(e) { 
        clearInterval(pTimer); lZone.style.display = "none";
        append("AVA", "Uplink timed out."); 
    } finally { sendBtn.disabled = false; }
}

input.onkeydown = (e) => { if(e.key==='Enter') transmit(); };
if(mem.length===0) append("AVA", "V1 LIVE. Glitch protocols active.");
else mem.forEach(m => append(m.role, m.text));
</script>
</body>
</html>
