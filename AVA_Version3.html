<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PROJECT_AVA // V4.2</title>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Outfit:wght@300;400;700&display=swap" rel="stylesheet">
<style>
:root { --bg:#020203; --accent:#00ffa3; --panel:#0a0a0c; --border:#1a1a1c; --text:#d1d1d1; --error:#ff3366; }
*{box-sizing:border-box; margin:0; padding:0; cursor:crosshair;}
body{background:var(--bg); color:var(--text); font-family:'Outfit', sans-serif; height:100vh; display:flex; flex-direction:column; overflow:hidden;}

/* 1. SELECTION HUB */
#setup-hub { position:fixed; inset:0; background:var(--bg); z-index:9999; display:flex; flex-direction:column; align-items:center; justify-content:center; padding:20px; text-align:center; }
.card-grid { display:grid; grid-template-columns:repeat(auto-fit, minmax(280px, 1fr)); gap:20px; width:100%; max-width:900px; margin-top:30px; }
.card { background:var(--panel); border:1px solid var(--border); padding:30px; transition:0.3s; }
.card:hover { border-color:var(--accent); transform:translateY(-5px); }
.card h2 { font-family:'JetBrains Mono'; color:#fff; margin-bottom:10px; font-size:1rem; letter-spacing:2px; }
.card p { font-size:0.8rem; opacity:0.6; margin-bottom:20px; line-height:1.4; }
.btn-boot { background:var(--accent); border:none; color:#000; padding:12px; font-family:'JetBrains Mono'; font-weight:700; cursor:pointer; width:100%; text-transform:uppercase; }

/* 2. LOADING SCREEN */
#loader { display:none; position:fixed; inset:0; background:rgba(0,0,0,0.95); z-index:10000; flex-direction:column; align-items:center; justify-content:center; }
.prog-container { width:300px; height:2px; background:#222; margin:20px 0; overflow:hidden; }
.prog-fill { width:0%; height:100%; background:var(--accent); transition:0.1s; box-shadow:0 0 10px var(--accent); }
.status-msg { font-family:'JetBrains Mono'; font-size:0.7rem; color:var(--accent); text-transform:uppercase; letter-spacing:2px; }

/* 3. ACTUAL CHAT UI */
#chat-ui { display:none; flex:1; flex-direction:column; height:100%; }
header { padding:15px 40px; background:var(--panel); border-bottom:1px solid var(--border); display:flex; justify-content:space-between; align-items:center; }
.logo { font-family:'JetBrains Mono'; font-weight:700; color:var(--accent); letter-spacing:5px; font-size:0.9rem; }

#viewport { flex:1; overflow-y:auto; padding:40px; scroll-behavior:smooth; background:radial-gradient(circle at center, #0a0a0c 0%, #020203 100%); }
.container { max-width:800px; margin:0 auto; width:100%; }
.msg { margin-bottom:40px; animation:slideUp 0.4s ease forwards; }
.role { font-family:'JetBrains Mono'; font-size:0.6rem; color:var(--accent); margin-bottom:8px; letter-spacing:3px; font-weight:700; text-transform:uppercase; }
.content { font-size:1.05rem; line-height:1.7; font-weight:300; white-space:pre-wrap; color:#ececec; }

.input-area { padding:25px 40px; background:var(--panel); border-top:1px solid var(--border); }
.input-bar { max-width:800px; margin:0 auto; display:flex; gap:20px; align-items:center; }
input { flex:1; background:transparent; border:none; color:#fff; font-size:1.1rem; outline:none; font-family:'Outfit'; }
#send-btn { background:transparent; border:none; color:var(--accent); font-family:'JetBrains Mono'; font-weight:700; cursor:pointer; font-size:0.9rem; transition:0.3s; }
#send-btn:disabled { opacity:0.2; cursor:wait; }

@keyframes slideUp { from{opacity:0; transform:translateY(10px);} to{opacity:1; transform:translateY(0);} }
</style>
</head>
<body>

<div id="setup-hub">
    <h1 style="color:#fff; letter-spacing:12px; font-family:'JetBrains Mono';">PROJECT_AVA</h1>
    <p style="opacity:0.4; font-size:0.7rem; margin-top:10px; font-family:'JetBrains Mono';">V4.2 // RAM_ONLY_MODE // NO_DISK_LOGS</p>
    <div class="card-grid">
        <div class="card">
            <h2>NANO_CORE</h2>
            <p>SmolLM2. Lowest RAM impact. Use this if your hardware is older or your wifi is absolute dogshit.</p>
            <button class="btn-boot" onclick="boot('HuggingFaceTB/SmolLM2-135M-Instruct')">STREAM NANO</button>
        </div>
        <div class="card">
            <h2>PRIME_CORE</h2>
            <p>Llama-3.2. Better logic. Recommended for daily use. Streams straight to memory.</p>
            <button class="btn-boot" onclick="boot('onnx-community/Llama-3.2-1B-Instruct')">STREAM PRIME</button>
        </div>
    </div>
</div>

<div id="loader">
    <div class="status-msg" id="status-txt">Handshake...</div>
    <div class="prog-container"><div class="prog-fill" id="prog-bar"></div></div>
    <p id="debug" style="font-size:0.6rem; color:#444; font-family:'JetBrains Mono';">Establishing direct RAM tunnel...</p>
</div>

<div id="chat-ui">
    <header>
        <div class="logo">AVA_SOVEREIGN</div>
        <div style="font-size:0.6rem; opacity:0.5; font-family:'JetBrains Mono';">[ DEV_TEAM: ONLINE ]</div>
    </header>

    <div id="viewport">
        <div class="container" id="flow"></div>
    </div>

    <div class="input-area">
        <div class="input-bar">
            <input type="text" id="user-input" placeholder="Transmit logic..." autocomplete="off">
            <button id="send-btn" onclick="transmit()">SEND</button>
        </div>
    </div>
</div>

<script type="module">
import { pipeline, env } from 'https://cdn.jsdelivr.net/npm/@xenova/transformers@2.17.2';

// BYPASS LOCAL CACHE COMPLETELY
env.allowLocalModels = false;
env.useBrowserCache = false;

let generator = null;
let mem = [];

window.boot = async function(repo) {
    document.getElementById('setup-hub').style.display = 'none';
    document.getElementById('loader').style.display = 'flex';
    
    try {
        generator = await pipeline('text-generation', repo, {
            quantized: true,
            progress_callback: (data) => {
                if (data.status === 'progress') {
                    const pct = Math.round((data.loaded / data.total) * 100);
                    document.getElementById('prog-bar').style.width = pct + "%";
                    document.getElementById('status-txt').textContent = `STREAMING: ${pct}%`;
                }
            }
        });

        // Switch to Chat UI
        document.getElementById('loader').style.display = 'none';
        document.getElementById('chat-ui').style.display = 'flex';
        append("AVA", "We're in. The engine is streaming live from memory. No disk space used, no traces left. What do you need?");
    } catch (e) {
        document.getElementById('status-txt').textContent = "STREAM FAILED";
        document.getElementById('status-txt').style.color = "var(--error)";
        console.error(e);
    }
}

function append(role, text) {
    const d = document.createElement('div');
    d.className = 'msg';
    const label = role === 'AVA' ? 'PROJECT_AVA' : 'USER';
    d.innerHTML = `<div class="role">${label}</div><div class="content">${text}</div>`;
    document.getElementById('flow').appendChild(d);
    document.getElementById('viewport').scrollTop = 999999;
}

window.transmit = async function() {
    const input = document.getElementById('user-input');
    const sendBtn = document.getElementById('send-btn');
    const val = input.value.trim();
    if (!val || !generator) return;
    
    append("USER", val);
    input.value = "";
    sendBtn.disabled = true;

    // Team AVA Persona
    const sys = "You are PROJECT_AVA. We are a collective team of developers. You are intelligent, blunt, and casually swear (shit, fuck). Be direct.";
    const messages = [
        { role: "system", content: sys },
        ...mem,
        { role: "user", content: val }
    ];

    try {
        const out = await generator(messages, { 
            max_new_tokens: 300, 
            temperature: 0.8,
            top_p: 0.9
        });
        const response = out[0].generated_text.at(-1).content;
        append("AVA", response);
        
        mem.push({ role: "user", content: val }, { role: "assistant", content: response });
        if (mem.length > 8) mem.splice(0, 2);
    } catch (e) {
        append("AVA", "Fuck. The inference failed. Your browser probably throttled the memory.");
        console.error(e);
    } finally {
        sendBtn.disabled = false;
        input.focus();
    }
}

// Enter Key Support
document.getElementById('user-input').onkeydown = (e) => { if(e.key === 'Enter') transmit(); };
</script>
</body>
</html>
