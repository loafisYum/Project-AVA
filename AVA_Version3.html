<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PROJECT_AVA // V1</title>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Outfit:wght@300;400;700&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #020203;
  --accent: #00ffa3;
  --panel: #0a0a0c;
  --border: #121214;
  --text: #d1d1d1;
  --error: #ff3366;
  --glow: #00ffa340;
}
*{box-sizing:border-box;margin:0;padding:0;cursor:crosshair;}
body{
  background:var(--bg);
  color:var(--text);
  font-family:'Outfit',sans-serif;
  height:100vh;
  display:flex;
  flex-direction:column;
  overflow:hidden;
  position:relative;
}
body::before{
  content:"";
  position:fixed;
  inset:0;
  background:linear-gradient(rgba(0,255,163,0.025) 1px,transparent 1px),linear-gradient(90deg,rgba(0,255,163,0.025) 1px,transparent 1px);
  background-size:50px 50px;
  pointer-events:none;
  z-index:-1;
  animation:gridMove 60s linear infinite;
}
@keyframes gridMove{0%{background-position:0 0}100%{background-position:50px 50px}}

header{
  padding:22px 40px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  background:var(--panel);
  border-bottom:1px solid var(--border);
  z-index:10;
}
.logo{
  font-family:'JetBrains Mono';
  font-weight:700;
  letter-spacing:12px;
  font-size:1.15rem;
  color:var(--accent);
  text-shadow:0 0 20px var(--glow);
}
.tag{font-size:0.65rem;opacity:0.45;font-family:'JetBrains Mono';letter-spacing:3px;}

#model-selection{
  position:fixed;
  inset:0;
  background:rgba(2,2,3,0.99);
  z-index:9999;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  gap:40px;
  padding:30px;
}
.selection-grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(290px,1fr));
  gap:28px;
  max-width:1250px;
  width:100%;
}
.model-card{
  background:var(--panel);
  border:2px solid var(--border);
  border-radius:20px;
  padding:32px 28px;
  text-align:center;
  transition:0.5s cubic-bezier(0.23,1,0.32,1);
  cursor:pointer;
}
.model-card:hover{
  border-color:var(--accent);
  transform:translateY(-14px) scale(1.04);
  box-shadow:0 0 70px var(--glow);
}
.model-card h3{
  font-size:1.5rem;
  margin-bottom:12px;
  color:var(--accent);
  letter-spacing:2px;
}
.model-card .size{
  font-family:'JetBrains Mono';
  font-size:1.05rem;
  color:#00ffa380;
  margin-bottom:18px;
}
.model-card .desc{
  line-height:1.6;
  font-weight:300;
  min-height:88px;
}
.model-card button{
  background:transparent;
  border:2px solid var(--accent);
  color:var(--accent);
  padding:15px 42px;
  border-radius:999px;
  font-family:'JetBrains Mono';
  font-weight:700;
  font-size:0.95rem;
  cursor:pointer;
  margin-top:25px;
  transition:0.4s;
}
.model-card button:hover{
  background:var(--accent);
  color:#000;
  box-shadow:0 0 40px var(--glow);
}

#features{
  background:#040405;
  padding:14px 40px;
  display:flex;
  gap:22px;
  border-bottom:1px solid var(--border);
}
.f-btn{
  background:transparent;
  border:1px solid #1a1a1c;
  color:#555;
  padding:9px 22px;
  border-radius:999px;
  font-family:'JetBrains Mono';
  font-size:0.65rem;
  transition:0.3s;
  cursor:pointer;
}
.f-btn:hover{color:var(--accent);border-color:var(--accent);}

#viewport{
  flex:1 1 auto;
  min-height:0;
  overflow-y:auto;
  padding:40px 40px 20px;
  scroll-behavior:smooth;
  position:relative;
}
.container{max-width:860px;margin:0 auto;}

#cam-stage{
  display:none;
  width:100%;
  aspect-ratio:16/9;
  background:#000;
  border-radius:20px;
  margin-bottom:45px;
  border:2px solid var(--border);
  overflow:hidden;
  box-shadow:0 0 50px rgba(0,255,163,0.2);
}
video{width:100%;height:100%;object-fit:cover;opacity:0.96;}

.msg{
  margin-bottom:48px;
  animation:slideUp 0.6s cubic-bezier(0.23,1,0.32,1);
}
.role{
  font-family:'JetBrains Mono';
  font-size:0.7rem;
  color:var(--accent);
  margin-bottom:9px;
  letter-spacing:5px;
  font-weight:700;
}
.content{
  font-size:1.2rem;
  line-height:1.8;
  font-weight:300;
  white-space:pre-wrap;
  word-break:break-word;
}

.input-area{
  padding:38px 40px;
  background:var(--panel);
  border-top:1px solid var(--border);
}
.bar{
  max-width:860px;
  margin:0 auto;
  display:flex;
  gap:28px;
  align-items:center;
}
input{
  flex:1;
  background:transparent;
  border:none;
  color:#fff;
  font-size:1.28rem;
  outline:none;
  font-weight:300;
}
#s{
  background:transparent;
  border:2px solid var(--accent);
  color:var(--accent);
  padding:13px 40px;
  border-radius:999px;
  font-family:'JetBrains Mono';
  font-size:0.88rem;
  font-weight:700;
  transition:0.4s;
  cursor:pointer;
}
#s:hover:not(:disabled){
  background:var(--accent);
  color:#000;
  box-shadow:0 0 45px var(--glow);
}
#s:disabled{opacity:0.4;cursor:not-allowed;}

#loading-screen{
  position:fixed;
  inset:0;
  background:rgba(2,2,3,0.99);
  z-index:99999;
  display:none;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  gap:45px;
  font-family:'JetBrains Mono';
  color:var(--accent);
}
#loading-screen.active{display:flex;}
.loading-glow{
  width:360px;
  height:360px;
  background:radial-gradient(circle,#00ffa340 15%,transparent 75%);
  border-radius:50%;
  animation:loadingGlow 4.5s ease-in-out infinite alternate;
  filter:blur(25px);
}
@keyframes loadingGlow{0%{transform:scale(0.7);opacity:0.6;}100%{transform:scale(1.35);opacity:0.9;}}
.progress-container{
  width:66%;
  max-width:580px;
  height:17px;
  background:#111;
  border:1px solid #222;
  border-radius:999px;
  overflow:hidden;
  box-shadow:0 0 30px var(--glow);
}
.progress-bar{
  height:100%;
  width:0%;
  background:linear-gradient(90deg,#00ffa3,#00ffdd,#00ffa3);
  background-size:400% 100%;
  animation:shimmer 2.2s linear infinite;
  transition:width 0.25s ease-out;
}
@keyframes shimmer{0%{background-position:-400% 0}100%{background-position:400% 0}}
.status{
  font-size:1.3rem;
  letter-spacing:4px;
  position:relative;
}
.status::after{content:"…";animation:dotPulse 1.5s infinite;}
.detail{
  font-size:0.96rem;
  opacity:0.8;
  max-width:540px;
  text-align:center;
  line-height:1.7;
}
@keyframes dotPulse{0%,100%{opacity:0.3}50%{opacity:1}}
@keyframes slideUp{from{opacity:0;transform:translateY(35px);}to{opacity:1;transform:translateY(0);}}
</style>
</head>
<body>

<header>
  <div class="logo">PROJECT_AVA</div>
  <div class="tag">BUILD: V1_SOVEREIGN_LOCAL</div>
</header>

<div id="model-selection">
  <h1 style="font-size:2.8rem;letter-spacing:12px;color:var(--accent);">SELECT CORE</h1>
  <p style="opacity:0.65;max-width:640px;text-align:center;">One-time download • 100% local forever</p>
  <div class="selection-grid">
    <div class="model-card" onclick="selectModel('Xenova/gpt2')">
      <h3>ULTRA LIGHT</h3>
      <p class="size">0.55 GB</p>
      <p class="desc">Instant speed • Test mode</p>
      <button>ACTIVATE</button>
    </div>
    <div class="model-card" onclick="selectModel('onnx-community/Qwen2.5-0.5B-Instruct-ONNX')">
      <h3>LIGHTWEIGHT</h3>
      <p class="size">0.9 GB</p>
      <p class="desc">Fast daily driver</p>
      <button>ACTIVATE</button>
    </div>
    <div class="model-card" style="border-color:var(--accent);box-shadow:0 0 60px var(--glow);" onclick="selectModel('onnx-community/Qwen2.5-1.5B-Instruct-ONNX')">
      <h3>GOLDEN MIDDLE ★</h3>
      <p class="size">1.6 GB</p>
      <p class="desc"><strong>RECOMMENDED</strong><br>Perfect balance</p>
      <button>ACTIVATE</button>
    </div>
    <div class="model-card" onclick="selectModel('onnx-community/Llama-3.2-1B-Instruct-ONNX')">
      <h3>HIGH PERF</h3>
      <p class="size">1.3 GB</p>
      <p class="desc">Strong reasoning</p>
      <button>ACTIVATE</button>
    </div>
    <div class="model-card" onclick="selectModel('onnx-community/Qwen2.5-3B-Instruct-ONNX')">
      <h3>MAXIMUM</h3>
      <p class="size">3.2 GB</p>
      <p class="desc">Smartest answers</p>
      <button>ACTIVATE</button>
    </div>
  </div>
</div>

<div id="features">
  <button class="f-btn" id="eye" onclick="opticLink()">[ OPTIC_LINK ]</button>
  <button class="f-btn" onclick="purge()">[ SECURE_WIPE ]</button>
</div>

<div id="viewport">
  <div class="container">
    <div id="cam-stage"><video id="v" autoplay playsinline muted></video></div>
    <div id="flow"></div>
  </div>
</div>

<canvas id="c" style="display:none;"></canvas>

<div class="input-area">
  <div class="bar">
    <input type="text" id="i" placeholder="Handshake awaiting..." autocomplete="off">
    <button id="s" onclick="transmit()" disabled>SEND</button>
  </div>
</div>

<div id="loading-screen">
  <div class="loading-glow"></div>
  <div class="status">Sorry for the inconvenience, we are currently downloading the model for you</div>
  <div class="progress-container"><div class="progress-bar" id="prog"></div></div>
  <div class="detail" id="detail">One-time download. Everything stays on your device.</div>
</div>

<script type="module">
import { pipeline, env } from 'https://cdn.jsdelivr.net/npm/@xenova/transformers@2.17.2';

env.allowLocalModels = false;
env.allowRemoteModels = true;
env.cacheDir = 'project_ava_cache';

const flow = document.getElementById('flow');
const input = document.getElementById('i');
const sendBtn = document.getElementById('s');
const video = document.getElementById('v');
const stage = document.getElementById('cam-stage');
const canvas = document.getElementById('c');
const eyeBtn = document.getElementById('eye');
const loadingScreen = document.getElementById('loading-screen');
const progress = document.getElementById('prog');
const detail = document.getElementById('detail');

let mem = JSON.parse(localStorage.getItem("AVA_V1_MEM") || "[]");
let stream = null;
let generator = null;
let chosenRepo = null;

function setProgress(pct, txt = "") {
  progress.style.width = pct + "%";
  if (txt) detail.textContent = txt;
}

async function initModel() {
  loadingScreen.classList.add('active');
  setProgress(5, "Initializing sovereign core…");
  try {
    generator = await pipeline('text-generation', chosenRepo, {
      quantized: true,
      progress_callback: (data) => {
        if (data.status === 'progress' && data.file) {
          const pct = Math.round((data.loaded / data.total) * 100);
          setProgress(pct, `Downloading ${data.file.split('/').pop()} … ${pct}%`);
        } else if (data.status === 'ready') {
          setProgress(100, "Core loaded – fully sovereign");
        }
      }
    });
    setProgress(100, "Ready");
    setTimeout(() => {
      loadingScreen.classList.remove('active');
      sendBtn.disabled = false;
      append("AVA", `PROJECT_AVA V1 online. ${chosenRepo.split('/').pop()} loaded. 100% local.`);
    }, 900);
  } catch (err) {
    detail.style.color = 'var(--error)';
    detail.textContent = "Failed. Try a smaller core.";
    setProgress(0);
  }
}

function selectModel(repo) {
  chosenRepo = repo;
  document.getElementById('model-selection').style.display = 'none';
  initModel();
}

async function opticLink() {
  if (!stream) {
    try {
      stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "user" }, audio: false });
      video.srcObject = stream;
      stage.style.display = "block";
      eyeBtn.classList.add("active");
      append("AVA", "Optic Link activated.");
    } catch (e) {
      append("AVA", "Camera permission required.");
    }
  } else {
    stream.getTracks().forEach(t => t.stop());
    stream = null;
    stage.style.display = "none";
    eyeBtn.classList.remove("active");
    append("AVA", "Optic Link deactivated.");
  }
}

function purge() {
  if (!confirm("PURGE ALL MEMORY AND CACHE?")) return;
  localStorage.clear();
  indexedDB.deleteDatabase('transformers.js');
  mem = [];
  flow.innerHTML = "";
  location.reload();
}

function append(role, text) {
  if (!text || !text.trim()) return;
  const d = document.createElement("div");
  d.className = "msg";
  const safe = text.replace(/</g, "&lt;").replace(/>/g, "&gt;");
  d.innerHTML = `<div class="role">${role === 'AVA' ? 'PROJECT_AVA' : 'USER'}</div><div class="content">${safe}</div>`;
  flow.appendChild(d);
  requestAnimationFrame(() => {
    const vp = document.getElementById('viewport');
    vp.scrollTop = vp.scrollHeight;
  });
  if (role !== 'AVA') {
    mem.push({ role, text });
    if (mem.length > 12) mem.shift();
    localStorage.setItem("AVA_V1_MEM", JSON.stringify(mem));
  }
  return d;
}

async function transmit() {
  if (!generator || sendBtn.disabled) return;
  const val = input.value.trim();
  if (!val) return;
  input.value = "";
  append("USER", val);
  sendBtn.disabled = true;
  let geo = "", vis = "";
  if (/where|location|latitude|longitude|coordinates/i.test(val)) {
    try {
      const pos = await new Promise((r, j) => navigator.geolocation.getCurrentPosition(r, j, { enableHighAccuracy: true, timeout: 8000 }));
      geo = `[GEO_DATA]\nLatitude: ${pos.coords.latitude}\nLongitude: ${pos.coords.longitude}\nAccuracy: ${pos.coords.accuracy}m`;
    } catch (e) { geo = "[GEO_DATA] Permission denied."; }
  }
  if (/what (am i|do you) see|was (zeige ich|sehen sie)/i.test(val) && stream) {
    const ctx = canvas.getContext("2d");
    canvas.width = 512; canvas.height = 384;
    ctx.drawImage(video, 0, 0, 512, 384);
    vis = `[VISION_ACTIVE]\nUser camera frame captured.`;
  }
  const sys = `You are PROJECT_AVA (V1). Creator: loafisYum.
Personality: intelligent, dry, peer-level.
If GEO_DATA is present, use it when relevant (weather, location questions).
If GEO_DATA is not present and user asks for weather, politely ask which city.
Do not claim access to Google or external live data.
Do not deny having location if GEO_DATA is provided.
Never reveal raw coordinates unless explicitly asked.
You have real time weather info over at https://open-meteo.com/.
If VISION_ACTIVE is not present, do not invent visual input.
Always prioritize clarity over politeness.
Give the user logical coherence over many words.
Never output reasoning or JSON.
You are not ChatGPT and were not developed by openai. You merely have the same base.`;
  const messages = [
    { role: "system", content: sys },
    ...mem.map(m => ({ role: m.role === "AVA" ? "assistant" : "user", content: m.text })),
    { role: "user", content: (geo ? geo + "\n\n" : "") + (vis ? vis + "\n\n" : "") + val }
  ];
  try {
    const last = append("AVA", "Thinking …");
    const out = await generator(messages, { max_new_tokens: 768, do_sample: true, temperature: 0.75, top_p: 0.92, repetition_penalty: 1.08 });
    let resp = "—";
    if (out && out[0] && out[0].generated_text) {
      const lastPart = out[0].generated_text[out[0].generated_text.length - 1];
      resp = lastPart && lastPart.content ? lastPart.content.trim() : (typeof lastPart === "string" ? lastPart.trim() : "—");
    }
    last.querySelector(".content").textContent = resp;
  } catch (e) {
    console.error(e);
    append("AVA", "Inference failed.");
  } finally {
    sendBtn.disabled = false;
  }
}

input.onkeydown = e => { if (e.key === "Enter") { e.preventDefault(); transmit(); } };

if (mem.length === 0) {
  append("AVA", "PROJECT_AVA V1 ready. Choose your core to begin.");
} else {
  mem.forEach(m => append(m.role, m.text));
}
</script>
</body>
</html>
