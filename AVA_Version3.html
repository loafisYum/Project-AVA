<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PROJECT_AVA V1.2 — LLaMA‑style Local</title>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Outfit:wght@300;400;700&display=swap" rel="stylesheet">
<style>
:root{--bg:#020203;--accent:#00ffa3;--panel:#0a0a0c;--border:#121214;--text:#d1d1d1;}
body{background:var(--bg);color:var(--text);font-family:'Outfit',sans-serif;height:100vh;display:flex;flex-direction:column;margin:0;}
header{background:var(--panel);border-bottom:1px solid var(--border);padding:20px;display:flex;justify-content:space-between;align-items:center;}
.logo{font-family:'JetBrains Mono';font-size:1.2rem;color:var(--accent);}
#viewport{flex:1;overflow-y:auto;padding:20px;}
.msg{margin-bottom:20px;}
.role{font-family:'JetBrains Mono';font-size:0.75rem;color:var(--accent);}
.content{font-size:1.1rem;line-height:1.5;white-space:pre-wrap;}
.input-area{background:var(--panel);padding:15px;border-top:1px solid var(--border);}
input{width:100%;padding:10px;border:none;background:#111;color:#fff;font-size:1rem;}
button{margin-top:8px;padding:10px 20px;border-radius:999px;border:2px solid var(--accent);background:transparent;color:var(--accent);cursor:pointer;}
button:hover{background:var(--accent);color:#000;}
button:disabled{opacity:0.4;cursor:not-allowed;}
</style>
</head>
<body>

<header>
  <div class="logo">PROJECT_AVA V1.2</div>
</header>

<div id="viewport"></div>

<div class="input-area">
  <input type="text" id="input" placeholder="Say something…" autocomplete="off">
  <button id="send">SEND</button>
</div>

<script type="module">
import { pipeline, env } from 'https://cdn.jsdelivr.net/npm/@xenova/transformers@2.17.2';

// ===== MODEL CONFIG =====
// You must host the ONNX model somewhere accessible
// e.g., http://localhost/models/llama‑small.onnx
const MODEL_URL = "https://your.server/path/to/llama‑small‑onnx/model";

// Enable WebGPU (fastest)
env.backend = 'webgpu';
env.allowLocalModels = true;
env.allowRemoteModels = true;

let gen = null;

// display message
function append(role, text) {
  const v = document.getElementById("viewport");
  const d = document.createElement("div");
  d.className = "msg";
  d.innerHTML = `<div class="role">${role}</div><div class="content">${text}</div>`;
  v.appendChild(d);
  v.scrollTop = v.scrollHeight;
}

// Initialize model
async function init() {
  append("AVA","Loading core… please wait.");
  try{
    gen = await pipeline("text‑generation", MODEL_URL, { quantized:true });
    append("AVA","Core loaded. Hello!");
    document.getElementById("send").disabled = false;
  }catch(e){
    append("AVA","Failed to load model. Make sure MODEL_URL is valid.");
    console.error(e);
  }
}

// send
async function sendMsg(){
  const val = document.getElementById("input").value.trim();
  if(!val || !gen) return;
  document.getElementById("input").value = "";
  append("YOU", val);

  const sys = `You are PROJECT_AVA (V1.2), intelligent and dry. Answer logically.`;
  append("AVA","Thinking…");

  try {
    const out = await gen(
      [{role:"system",content:sys},{role:"user",content:val}],
      { max_new_tokens:150, do_sample:true, temperature:0.7 }
    );
    append("AVA", out[0].generated_text.trim());
  } catch(e){
    append("AVA","Error generating.");
    console.error(e);
  }
}

document.getElementById("send").onclick = sendMsg;
document.getElementById("input").addEventListener("keydown", e => { if(e.key==="Enter") sendMsg(); });

// start
document.getElementById("send").disabled = true;
init();

</script>

</body>
</html>
