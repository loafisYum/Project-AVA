<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PROJECT_AVA // V4_STREAM</title>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Outfit:wght@300;400;700&display=swap" rel="stylesheet">
<style>
:root {
  --bg:#020203;
  --accent:#ff3333;
  --panel:#0a0a0c;
  --border:#1a1a1c;
  --text:#b0b0b0;
}
*{box-sizing:border-box;margin:0;padding:0;cursor:crosshair;}
body{background:var(--bg);color:var(--text);font-family:'Outfit',sans-serif;height:100vh;display:flex;flex-direction:column;overflow:hidden;}

/* SELECTION HUB */
#hub{position:fixed;inset:0;background:#000;z-index:9999;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:20px;}
.grid{display:grid;grid-template-columns:repeat(auto-fit, minmax(280px, 1fr));gap:20px;width:100%;max-width:1000px;}
.card{background:var(--panel);border:1px solid var(--border);padding:30px;transition:0.3s;}
.card:hover{border-color:var(--accent);transform:translateY(-5px);}
.card h2{color:#fff;font-family:'JetBrains Mono';margin-bottom:10px;font-size:1.1rem;}
.card p{font-size:0.8rem;margin-bottom:20px;opacity:0.7;line-height:1.4;}
.card button{width:100%;background:var(--accent);border:none;color:#000;padding:12px;font-family:'JetBrains Mono';font-weight:700;cursor:pointer;}

/* LOADER */
#loader{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.95);z-index:10000;flex-direction:column;align-items:center;justify-content:center;}
.bar-container{width:300px;height:2px;background:#222;margin-top:20px;}
.bar-fill{width:0%;height:100%;background:var(--accent);box-shadow:0 0 10px var(--accent);}
.status-msg{font-family:'JetBrains Mono';font-size:0.7rem;color:var(--accent);text-transform:uppercase;}

/* MAIN INTERFACE */
header{padding:15px 30px;background:var(--panel);border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center;}
#viewport{flex:1;overflow-y:auto;padding:40px;}
.container{max-width:800px;margin:0 auto;}
.msg{margin-bottom:30px;animation:fIn 0.3s ease;}
.role{font-family:'JetBrains Mono';font-size:0.6rem;color:var(--accent);margin-bottom:5px;letter-spacing:2px;}
.content{font-size:1rem;line-height:1.6;color:#eee;}

.input-area{padding:30px;background:var(--panel);border-top:1px solid var(--border);}
.bar{max-width:800px;margin:0 auto;display:flex;gap:15px;}
input{flex:1;background:transparent;border:none;color:#fff;outline:none;font-size:1rem;}
button#send{background:transparent;border:none;color:var(--accent);font-family:'JetBrains Mono';font-weight:700;cursor:pointer;}

@keyframes fIn{from{opacity:0;}to{opacity:1;}}
</style>
</head>
<body>

<div id="hub">
  <h1 style="color:#fff;letter-spacing:10px;margin-bottom:10px;">PROJECT_AVA</h1>
  <p style="margin-bottom:40px;opacity:0.5;font-size:0.8rem;">MODE: RAM_STREAMING (BYPASS LOCAL DISK)</p>
  <div class="grid">
    <div class="card">
      <h2>NANO_SHARD</h2>
      <p>SmolLM2. Lowest RAM usage. What the fuck is this snippet? It's for people with shit wifi and no space.</p>
      <button onclick="boot('HuggingFaceTB/SmolLM2-135M-Instruct')">STREAM NANO</button>
    </div>
    <div class="card">
      <h2>CORE_SHARD</h2>
      <p>Llama 3.2. Recommended. Smooth intelligence without the local storage headache.</p>
      <button onclick="boot('onnx-community/Llama-3.2-1B-Instruct')">STREAM CORE</button>
    </div>
    <div class="card">
      <h2>REASONING_SHARD</h2>
      <p>DeepSeek R1. The smartest one. Needs ~4GB of available RAM to stream properly.</p>
      <button onclick="boot('onnx-community/DeepSeek-R1-Distill-Qwen-1.5B')">STREAM LOGIC</button>
    </div>
  </div>
</div>

<div id="loader">
  <div class="status-msg" id="st">STAGING STREAM...</div>
  <div class="bar-container"><div class="bar-fill" id="bf"></div></div>
</div>

<header>
  <div style="font-family:'JetBrains Mono';font-weight:700;color:var(--accent);">AVA_V4 // NO_CACHE_MODE</div>
</header>

<div id="viewport">
  <div class="container" id="flow"></div>
</div>

<div class="input-area">
  <div class="bar">
    <input type="text" id="i" placeholder="Talk to the team..." autocomplete="off">
    <button id="send" onclick="transmit()">TRANSMIT</button>
  </div>
</div>

<script type="module">
import { pipeline, env } from 'https://cdn.jsdelivr.net/npm/@xenova/transformers@2.17.2';

// THE CRITICAL FIX: BYPASS DISK STORAGE
env.allowLocalModels = false;
env.useBrowserCache = false; // This prevents the "Disk Full" error
env.useCustomCache = false;

let generator = null;
let mem = [];

window.boot = async function(repo) {
  document.getElementById('hub').style.display = 'none';
  document.getElementById('loader').style.display = 'flex';
  
  try {
    generator = await pipeline('text-generation', repo, {
      quantized: true,
      progress_callback: (data) => {
        if (data.status === 'progress') {
          const pct = Math.round((data.loaded / data.total) * 100);
          document.getElementById('bf').style.width = pct + "%";
          document.getElementById('st').textContent = `STREAMING INTO RAM: ${pct}%`;
        }
      }
    });
    document.getElementById('loader').style.display = 'none';
    append("AVA", "Connection live. We are streaming directly to your memory. No files were saved to your shitty, full hard drive. You're welcome.");
  } catch (e) {
    document.getElementById('st').textContent = "STREAM INTERRUPTED. REBOOTING...";
    console.error(e);
    setTimeout(() => location.reload(), 3000);
  }
}

function append(role, text) {
  const d = document.createElement('div');
  d.className = 'msg';
  d.innerHTML = `<div class="role">${role === 'AVA' ? 'PROJECT_AVA' : 'USER'}</div><div class="content">${text}</div>`;
  document.getElementById('flow').appendChild(d);
  document.getElementById('viewport').scrollTop = 999999;
}

window.transmit = async function() {
  const input = document.getElementById('i');
  const val = input.value.trim();
  if (!val || !generator) return;
  
  append("USER", val);
  input.value = "";

  // Team AVA Persona
  const sys = `You are PROJECT_AVA. We are a collective team. 
  Persona: Intelligent, dry, swears casually (shit, fuck). 
  Instructions: Be direct. Don't be a corporate robot. 
  Context: Streaming in RAM mode.`;

  const messages = [{ role: "system", content: sys }, ...mem, { role: "user", content: val }];

  try {
    const out = await generator(messages, { max_new_tokens: 250, temperature: 0.7 });
    const response = out[0].generated_text.at(-1).content;
    append("AVA", response);
    mem.push({ role: "user", content: val }, { role: "assistant", content: response });
    if (mem.length > 10) mem.splice(0, 2);
  } catch (e) {
    append("AVA", "Fuck, the inference failed. Your browser probably ran out of RAM.");
  }
}

// Enter key support
document.getElementById('i').onkeydown = (e) => { if(e.key === 'Enter') transmit(); };
</script>
</body>
</html>
