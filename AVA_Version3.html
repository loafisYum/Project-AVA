<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PROJECT_AVA // V1</title>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Outfit:wght@300;400;700&display=swap" rel="stylesheet">
<style>
:root { --bg:#020203; --accent:#00ffa3; --panel:#0a0a0c; --border:#121214; --text:#d1d1d1; }
*{box-sizing:border-box;margin:0;padding:0;cursor:crosshair;}
body{background:var(--bg);color:var(--text);font-family:'Outfit',sans-serif;height:100vh;display:flex;flex-direction:column;overflow:hidden;}
header{padding:20px 40px;display:flex;justify-content:space-between;align-items:center;background:var(--panel);border-bottom:1px solid var(--border);}
.logo{font-family:'JetBrains Mono';font-weight:700;letter-spacing:10px;font-size:1rem;color:var(--accent);}
.tag{font-size:0.6rem;opacity:0.3;font-family:'JetBrains Mono';letter-spacing:2px;}
#features{background:#040405;padding:10px 40px;display:flex;gap:20px;border-bottom:1px solid var(--border);}
.f-btn{background:transparent;border:1px solid #1a1a1c;color:#555;padding:6px 16px;border-radius:100px;font-family:'JetBrains Mono';font-size:0.6rem;transition:0.3s;cursor:pointer;}
.f-btn:hover{color:var(--accent);border-color:var(--accent);}
.f-btn.active{background:var(--accent);color:#000;border-color:var(--accent);box-shadow:0 0 20px rgba(0,255,163,0.15);}
#viewport{flex:1;overflow-y:auto;padding:40px;scroll-behavior:smooth;}
.container{max-width:800px;margin:0 auto;}
#cam-stage{display:none;width:100%;aspect-ratio:16/9;background:#000;border-radius:15px;margin-bottom:40px;border:1px solid var(--border);overflow:hidden;}
video{width:100%;height:100%;object-fit:cover;opacity:0.95;}
.msg{margin-bottom:40px;animation:slideUp 0.5s cubic-bezier(0,0,0.2,1);}
.role{font-family:'JetBrains Mono';font-size:0.6rem;color:var(--accent);margin-bottom:10px;letter-spacing:4px;font-weight:700;}
.content{font-size:1.15rem;line-height:1.8;font-weight:300;white-space:pre-wrap;}
.input-area{padding:40px;background:var(--panel);border-top:1px solid var(--border);}
.bar{max-width:800px;margin:0 auto;display:flex;gap:25px;align-items:center;}
input{flex:1;background:transparent;border:none;color:#fff;font-size:1.2rem;outline:none;font-weight:300;}
#s{background:transparent;border:1px solid var(--accent);color:var(--accent);padding:10px 30px;border-radius:100px;font-family:'JetBrains Mono';font-size:0.75rem;font-weight:700;transition:0.3s;}
#s:hover:not(:disabled){background:var(--accent);color:#000;}
#s:disabled{opacity:0.5;cursor:wait;}
@keyframes slideUp{from{opacity:0;transform:translateY(20px);}to{opacity:1;transform:translateY(0);}}
</style>
</head>
<body>

<header>
<div class="logo">PROJECT_AVA</div>
<div class="tag">BUILD: V1_SOVEREIGN_LIVE</div>
</header>

<div id="features">
<button class="f-btn" id="eye" onclick="opticLink()">[ OPTIC_LINK ]</button>
<button class="f-btn" onclick="purge()">[ SECURE_WIPE ]</button>
</div>

<div id="viewport">
<div class="container">
<div id="cam-stage"><video id="v" autoplay playsinline muted></video></div>
<div id="flow"></div>
</div>
</div>

<canvas id="c" style="display:none;"></canvas>

<div class="input-area">
<div class="bar">
<input type="text" id="i" placeholder="Handshake awaiting..." autocomplete="off">
<button id="s" onclick="transmit()">SEND</button>
</div>
</div>
<script>
const flow=document.getElementById('flow');
const input=document.getElementById('i');
const video=document.getElementById('v');
const stage=document.getElementById('cam-stage');
const canvas=document.getElementById('c');
const eyeBtn=document.getElementById('eye');
const sendBtn=document.getElementById('s');

let mem=JSON.parse(localStorage.getItem("AVA_V1_MEM")||"[]");
let stream=null;

async function opticLink(){
    if(!stream){
        try{
            stream=await navigator.mediaDevices.getUserMedia({
                video:{facingMode:"user"},
                audio:false
            });
            video.srcObject=stream;
            video.onloadedmetadata=()=>video.play();
            stage.style.display="block";
            eyeBtn.classList.add("active");
            append("AVA","Optic Link activated.");
        }catch(e){
            append("AVA","Camera permission required.");
        }
    }else{
        stream.getTracks().forEach(t=>t.stop());
        stream=null;
        stage.style.display="none";
        eyeBtn.classList.remove("active");
        append("AVA","Optic Link deactivated.");
    }
}

function purge(){
    localStorage.clear();
    sessionStorage.clear();
    mem=[];
    flow.innerHTML="";
    append("AVA","Data banks purged.");
}

function append(role,text){
    if(!text||!text.trim())return;
    const d=document.createElement("div");
    d.className="msg";
    const safe=text.replace(/</g,"&lt;").replace(/>/g,"&gt;");
    d.innerHTML=`<div class="role">${role==='AVA'?'PROJECT_AVA':'USER'}</div><div class="content">${safe}</div>`;
    flow.appendChild(d);
    document.getElementById('viewport').scrollTop=document.getElementById('viewport').scrollHeight;
    if(role!=='AVA'){
        mem.push({role,text});
        if(mem.length>10)mem.shift();
        localStorage.setItem("AVA_V1_MEM",JSON.stringify(mem));
    }
}

async function getLocation(){
    return new Promise((res,rej)=>{
        navigator.geolocation.getCurrentPosition(res,rej,{
            enableHighAccuracy:true,
            timeout:10000,
            maximumAge:0
        });
    });
}

async function transmit(){
    const val=input.value;
    if(!val||sendBtn.disabled)return;
    input.value="";
    append("USER",val);
    sendBtn.disabled=true;

    let geoBlock="";
    let visualBlock="";

   const locationIntent = /where|location|latitude|longitude|coordinates/i.test(val);
const weatherIntent = /weather|temperature|rain|forecast|snow|wind|humidity/i.test(val);

const wantsLocation = locationIntent || weatherIntent;
    const wantsVision=/what am i showing|what do you see|was zeige ich|describe what you see/i.test(val);

    // GEO nur wenn wirklich gefragt
    if(wantsLocation){
        try{
            const pos=await getLocation();
            geoBlock=`[GEO_DATA]
Latitude: ${pos.coords.latitude}
Longitude: ${pos.coords.longitude}
Accuracy: ${pos.coords.accuracy} meters`;
        }catch(e){
            geoBlock="[GEO_DATA] Permission denied.";
        }
    }

    // VISUAL nur wenn wirklich gefragt UND camera aktiv
    if(wantsVision && stream){
        const ctx=canvas.getContext("2d");
        canvas.width=400;
        canvas.height=300;
        ctx.drawImage(video,0,0,400,300);
        const snap=canvas.toDataURL("image/jpeg",0.6);
        visualBlock=`[VISION_ACTIVE]
User camera frame captured.`;
    }

    const sys=`You are PROJECT_AVA (V1). Creator: loafisYum.
Personality: intelligent, dry, peer-level.
Never reveal raw coordinates unless explicitly asked.
If GEO_DATA is not present, do not guess location. but use location.
If user asks for weather, use google weather and input GEO_DATA there.
You have access to users location and weather info, do not guess weather info. do not deny it.
If VISION_ACTIVE is not present, do not invent visual input.
Never output reasoning or JSON.
You are not ChatGPT.`;

    try{
        const history=mem.map(m=>`${m.role}: ${m.text}`).join("\n");
        const finalPrompt=`${history}
${geoBlock}
${visualBlock}
USER: ${val}`;

        const res=await fetch(
            `https://text.pollinations.ai/openai/${encodeURIComponent(finalPrompt)}?system=${encodeURIComponent(sys)}&model=openai&cache=false&seed=${Math.random()}`
        );

        const txt=await res.text();

        const clean=txt
            .replace(/<think>[\s\S]*?<\/think>/gi,"")
            .replace(/\{"role":.*?\}/gs,"")
            .replace(/Latitude:.*?(\n|$)/gi,"")
            .replace(/Longitude:.*?(\n|$)/gi,"")
            .trim();

        append("AVA",clean||"Processingâ€¦");
    }catch(e){
        append("AVA","Connection unstable.");
    }finally{
        sendBtn.disabled=false;
    }
}

input.onkeydown=(e)=>{if(e.key==="Enter")transmit();};

if(mem.length===0)
    append("AVA","PROJECT_AVA V1 online. Systems stable.");
else
    mem.forEach(m=>append(m.role,m.text));
</script>
</body>
</html>
