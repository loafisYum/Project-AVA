<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PROJECT_AVA // V4.5_SWITCH</title>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Outfit:wght@300;400;700&display=swap" rel="stylesheet">
<style>
:root { --bg:#050506; --accent:#00ffa3; --panel:#0f0f12; --border:#1c1c1f; --text:#d1d1d1; --error:#ff3366; }
*{box-sizing:border-box; margin:0; padding:0; cursor:crosshair;}
body{background:var(--bg); color:var(--text); font-family:'Outfit', sans-serif; height:100vh; display:flex; flex-direction:column; overflow:hidden;}

/* SECTION TOGGLING */
.state-section { display:none; flex-direction:column; height:100%; width:100%; position:fixed; inset:0; }
.state-section.active { display:flex; }

/* HUB */
#hub-state { background:var(--bg); align-items:center; justify-content:center; padding:20px; text-align:center; z-index:100; }
.grid { display:grid; grid-template-columns:repeat(auto-fit, minmax(280px, 1fr)); gap:20px; width:100%; max-width:900px; margin-top:30px; }
.card { background:var(--panel); border:1px solid var(--border); padding:30px; transition:0.3s; }
.card:hover { border-color:var(--accent); transform:translateY(-5px); }
.card h2 { font-family:'JetBrains Mono'; color:#fff; font-size:1rem; letter-spacing:2px; }
.card p { font-size:0.8rem; opacity:0.6; margin:15px 0; line-height:1.4; }
.boot-btn { background:var(--accent); border:none; color:#000; padding:12px; font-family:'JetBrains Mono'; font-weight:700; cursor:pointer; width:100%; }

/* LOADER */
#load-state { background:rgba(2,2,3,0.98); align-items:center; justify-content:center; z-index:200; }
.bar-track { width:300px; height:2px; background:#1a1a1c; margin:20px 0; overflow:hidden; }
.bar-fill { width:0%; height:100%; background:var(--accent); box-shadow:0 0 10px var(--accent); transition:0.1s; }
.status { font-family:'JetBrains Mono'; font-size:0.7rem; color:var(--accent); text-transform:uppercase; letter-spacing:2px; }

/* CHAT INTERFACE */
#chat-state { background:var(--bg); z-index:50; }
header { padding:15px 40px; background:var(--panel); border-bottom:1px solid var(--border); display:flex; justify-content:space-between; align-items:center; }
.logo { font-family:'JetBrains Mono'; font-weight:700; color:var(--accent); letter-spacing:5px; font-size:0.9rem; }
.back-btn { background:transparent; border:1px solid #333; color:#666; font-family:'JetBrains Mono'; font-size:0.6rem; padding:5px 10px; cursor:pointer; }
.back-btn:hover { color:var(--accent); border-color:var(--accent); }

#viewport { flex:1; overflow-y:auto; padding:40px; background:radial-gradient(circle at bottom, #0a0a0c 0%, #020203 100%); }
.container { max-width:800px; margin:0 auto; width:100%; }
.msg { margin-bottom:40px; animation:slide 0.3s ease forwards; }
.role { font-family:'JetBrains Mono'; font-size:0.6rem; color:var(--accent); margin-bottom:8px; font-weight:700; }
.content { font-size:1.05rem; line-height:1.7; white-space:pre-wrap; color:#ececec; }

.input-area { padding:25px 40px; background:var(--panel); border-top:1px solid var(--border); }
.bar { max-width:800px; margin:0 auto; display:flex; gap:20px; }
input { flex:1; background:transparent; border:none; color:#fff; font-size:1.1rem; outline:none; }
#send { background:transparent; border:none; color:var(--accent); font-family:'JetBrains Mono'; font-weight:700; cursor:pointer; }
#send:disabled { opacity:0.2; }

@keyframes slide { from{opacity:0; transform:translateY(10px);} to{opacity:1; transform:translateY(0);} }
</style>
</head>
<body>

<section id="hub-state" class="state-section active">
    <h1 style="color:#fff; letter-spacing:10px; font-family:'JetBrains Mono';">PROJECT_AVA</h1>
    <p style="opacity:0.4; font-size:0.7rem; margin-top:10px; font-family:'JetBrains Mono';">RAM_STREAMING // NO_LOCAL_DISK_CACHE</p>
    <div class="grid">
        <div class="card">
            <h2>NANO_SHARD</h2>
            <p>What the fuck is this snippet? It's the 135M model. Use this for shit wifi.</p>
            <button class="boot-btn" onclick="boot('HuggingFaceTB/SmolLM2-135M-Instruct')">INJECT NANO</button>
        </div>
        <div class="card">
            <h2>PRIME_SHARD</h2>
            <p>Llama 3.2 1B. Higher logic, higher RAM usage. Streams directly to memory.</p>
            <button class="boot-btn" onclick="boot('onnx-community/Llama-3.2-1B-Instruct')">INJECT PRIME</button>
        </div>
    </div>
</section>

<section id="load-state" class="state-section">
    <div class="status" id="st">STAGING CDN TUNNEL...</div>
    <div class="bar-track"><div class="bar-fill" id="bf"></div></div>
    <p id="debug" style="font-size:0.6rem; color:#444; font-family:'JetBrains Mono';">Establishing RAM-stream protocols...</p>
</section>

<section id="chat-state" class="state-section">
    <header>
        <div class="logo">AVA_SOVEREIGN</div>
        <button class="back-btn" onclick="switchState('hub-state')">SWITCH_MODEL</button>
    </header>
    <div id="viewport">
        <div class="container" id="flow"></div>
    </div>
    <div class="input-area">
        <div class="bar">
            <input type="text" id="i" placeholder="Talk to the team..." autocomplete="off">
            <button id="send" onclick="transmit()">SEND</button>
        </div>
    </div>
</section>

<script type="module">
import { pipeline, env } from 'https://cdn.jsdelivr.net/npm/@xenova/transformers@2.17.2';

// THE "NO DISK" KILLER CONFIG
env.allowLocalModels = false;
env.useBrowserCache = false; // Prevents the disk from getting full

let generator = null;
let mem = [];

// THE UI SWITCH
window.switchState = function(stateId) {
    document.querySelectorAll('.state-section').forEach(s => s.classList.remove('active'));
    document.getElementById(stateId).classList.add('active');
};

window.boot = async function(repo) {
    switchState('load-state');
    
    try {
        generator = await pipeline('text-generation', repo, {
            quantized: true,
            progress_callback: (data) => {
                if (data.status === 'progress') {
                    const pct = Math.round((data.loaded / data.total) * 100);
                    document.getElementById('bf').style.width = pct + "%";
                    document.getElementById('st').textContent = `STREAMING INTO RAM: ${pct}%`;
                }
            }
        });

        // SUCCESSFUL BOOT -> SWITCH TO CHAT
        switchState('chat-state');
        append("AVA", "We are online. The team is standing by. We've bypassed your disk entirely, so don't worry about space. What's the move?");
    } catch (e) {
        document.getElementById('st').textContent = "CONNECTION FAILED";
        document.getElementById('st').style.color = "var(--error)";
        console.error("AVA_CORE_ERROR:", e);
        setTimeout(() => switchState('hub-state'), 3000);
    }
}

function append(role, text) {
    const d = document.createElement('div');
    d.className = 'msg';
    d.innerHTML = `<div class="role">${role === 'AVA' ? 'PROJECT_AVA' : 'USER'}</div><div class="content">${text}</div>`;
    document.getElementById('flow').appendChild(d);
    document.getElementById('viewport').scrollTop = 999999;
}

window.transmit = async function() {
    const input = document.getElementById('i');
    const btn = document.getElementById('send');
    const val = input.value.trim();
    if (!val || !generator) return;
    
    append("USER", val);
    input.value = "";
    btn.disabled = true;

    // Team AVA Personality
    const sys = "You are PROJECT_AVA. We are a collective team. You are blunt, smart, and swear casually (shit, fuck). Be direct.";
    const messages = [{ role: "system", content: sys }, ...mem, { role: "user", content: val }];

    try {
        const out = await generator(messages, { max_new_tokens: 250, temperature: 0.8 });
        const response = out[0].generated_text.at(-1).content;
        append("AVA", response);
        mem.push({ role: "user", content: val }, { role: "assistant", content: response });
        if (mem.length > 6) mem.splice(0, 2);
    } catch (e) {
        append("AVA", "Fuck. The logic engine tripped. RAM might be tight.");
    } finally {
        btn.disabled = false;
        input.focus();
    }
}

document.getElementById('i').onkeydown = (e) => { if(e.key === 'Enter') transmit(); };
</script>
</body>
</html>
