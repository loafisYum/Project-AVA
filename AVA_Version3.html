<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF‑8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>PROJECT_AVA // V1.2</title>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Outfit:wght@300;400;700&display=swap" rel="stylesheet">
<style>
:root{--bg:#020203;--accent:#00ffa3;--panel:#0a0a0c;--border:#121214;--text:#d1d1d1;--glow:#00ffa340;}
body{background:var(--bg);color:var(--text);font-family:'Outfit',sans-serif;height:100vh;display:flex;flex-direction:column;margin:0;}
header{padding:22px 40px;background:var(--panel);border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center;}
.logo{font-family:'JetBrains Mono';font-weight:700;letter-spacing:12px;font-size:1.15rem;color:var(--accent);text-shadow:0 0 20px var(--glow);}
.tag{font-size:0.65rem;opacity:0.45;font-family:'JetBrains Mono';letter-spacing:3px;}
#viewport{flex:1 1 auto;overflow-y:auto;padding:20px;scroll-behavior:smooth;}
.msg{margin-bottom:20px;}
.role{font-family:'JetBrains Mono';font-size:0.7rem;color:var(--accent);margin-bottom:4px;font-weight:700;}
.content{font-size:1.15rem;line-height:1.5;white-space:pre-wrap;word-break:break-word;}
.input-area{padding:15px 20px;background:var(--panel);border-top:1px solid var(--border);}
.bar{display:flex;gap:15px;align-items:center;}
input{flex:1;background:transparent;border:none;color:#fff;font-size:1.1rem;outline:none;font-weight:300;}
#send-btn{background:transparent;border:2px solid var(--accent);color:var(--accent);padding:10px 24px;border-radius:999px;cursor:pointer;}
#send-btn:hover{background:var(--accent);color:#000;box-shadow:0 0 35px var(--glow);}
#send-btn:disabled{opacity:0.4;cursor:not-allowed;}
</style>
</head>
<body>

<header>
  <div class="logo">PROJECT_AVA</div>
  <div class="tag">V1.2</div>
</header>

<div id="viewport"></div>

<div class="input-area">
  <div class="bar">
    <input type="text" id="user-input" placeholder="Ask Project_AVA something..." autocomplete="off">
    <button id="send-btn">SEND</button>
  </div>
</div>

<script>
// —————— CONFIG ——————
// Optional Publishable API key (if you have one)
// const API_KEY = "pk_XXXXXXXX"; 
const BASE_URL = "https://text.pollinations.ai/openai";

const viewport = document.getElementById("viewport");
const inputEl = document.getElementById("user-input");
const sendBtn = document.getElementById("send-btn");

// append chat bubble
function append(role,text){
  if(!text) return;
  const msg = document.createElement("div");
  msg.className = "msg";
  msg.innerHTML = `<div class="role">${role}</div><div class="content">${text}</div>`;
  viewport.appendChild(msg);
  viewport.scrollTop = viewport.scrollHeight;
  return msg;
}

// send and stream
async function sendMessage(){
  const val = inputEl.value.trim();
  if(!val) return;
  inputEl.value = "";
  append("YOU", val);
  sendBtn.disabled = true;

  const systemPrompt = `
You are PROJECT_AVA (V1.2).
Intelligent, dry, peer-level.
Respond like Project_AVA with logic and reasoning.
  `;

  try {
    // create abort controller for SSE
    const controller = new AbortController();
    const headers = {
      "Content-Type": "application/json"
      // If using an API key:
      // "Authorization": "Bearer " + API_KEY
    };

    // open SSE connection to pollinations OpenAI endpoint
    const es = new EventSource(`${BASE_URL}`, {
      withCredentials: true
    });

    let lastMsg = append("PROJECT_AVA",""); // placeholder

    // send POST (SSE fallback listens)
    await fetch(BASE_URL, {
      method: "POST",
      headers,
      body: JSON.stringify({
        model: "openai",
        messages: [
          { role: "system", content: systemPrompt },
          { role: "user",   content: val }
        ],
        stream: true
      }),
      signal: controller.signal
    });

    // listen for token events
    es.onmessage = e => {
      const chunk = e.data.trim();
      if(chunk === "[DONE]"){
        es.close();
        controller.abort(); 
        sendBtn.disabled = false;
      } else {
        lastMsg.querySelector(".content").textContent += chunk;
      }
    };

    es.onerror = err => {
      es.close();
      append("PROJECT_AVA","(stream error — fallback text may appear slower)");
      sendBtn.disabled = false;
    };

  } catch (err) {
    console.error(err);
    append("PROJECT_AVA","Oops, something went wrong!");
    sendBtn.disabled = false;
  }
}

sendBtn.onclick = sendMessage;
inputEl.addEventListener("keydown", e => { if(e.key==="Enter") sendMessage(); });

// greet
append("PROJECT_AVA","Project_AVA V1.2 online. What do you want?");
</script>

</body>
</html>
